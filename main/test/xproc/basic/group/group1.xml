<p:pipeline name="pipeline" xmlns:p="http://www.w3.org/ns/xproc">

  <p:choose>
    <p:when test="count(.)=1">
        <p:identity>
            <p:input port="source">
                <p:inline>
                    <test1/>
                </p:inline>
            </p:input>
        </p:identity>
        <p:declare-step name="test1" type="mine:identity1">
    <p:input port="source" primary="true"/>
    <p:output port="result" primary="true"/>

    <p:identity>
        <p:input port="source">
            <p:inline>
                <test/>
            </p:inline>
        </p:input>
    </p:identity>
    
</p:declare-step>
    </p:when>

    <p:otherwise>
        <p:identity>
            <p:input port="source">
                <p:inline>
                    <test2/>
                </p:inline>
            </p:input>
        </p:identity>
    </p:otherwise>
  </p:choose>

</p:pipeline>
