#!/bin/bash
XPROCXQ_HOME=/Users/jimfuller/Source/Webcomposite/xprocxq/main
CLASSPATH=/Users/jimfuller/Source/Webcomposite/xprocxq/main/lib/net:/Users/jimfuller/Source/Webcomposite/xprocxq/main/lib/saxon9sa/saxon9sa.jar:/Users/jimfuller/Source/Webcomposite/xprocxq/main/lib/saxon9sa:/Users/jimfuller/Source/Webcomposite/xprocxq/main/lib
export CLASSPATH XPROCXQ_HOME

MINPARAMS=1

usage()
{
cat << EOF
Usage: xprocxq [options] [--import library|pipeline] source pipeline

xprocxq processes XProc pipeline documents.

OPTIONS:
   -h      Show this message
   -d      Show debug information
   -t      Show timing information
   -i      Set input port document
   -o      Set output port document
   -x      Enable XInclude processing 
   -d      Enable DTD validation


EOF
}

oval=
ival=
dval=
dflag=
tflag=
iflag=
oflag=
xiflag=
valval=
trace='' # -traceout:#null
while getopts 'di:o:xhtv:' OPTION
do
  case $OPTION in
  d)	dflag=1
                ;;
  t)	tflag=1
                ;;
  i)	iflag=1
                ival="$OPTARG"
                ;;
  o)	oflag=1
                oval="$OPTARG"
                ;;
  x)	xiflag="-xi"
                ;;
  v)	valval="-$OPTARG:on"
                ;;
  h)	usage
                exit 2
                ;;
  esac
done
shift $(($OPTIND - 1))

if [[ -z $1 ]] || [[ -z $2 ]]
then
     usage
     exit 1
fi

java net.sf.saxon.Query $valval $xiflag -sa -s:$1  -tree:linked -l -update:on -ext:on -q:$XPROCXQ_HOME/src/xquery/xproc.xq +xproc="$2" +stdin="$1" dflag="$dflag" tflag="$tflag" ival="$ival" oval="$oval"